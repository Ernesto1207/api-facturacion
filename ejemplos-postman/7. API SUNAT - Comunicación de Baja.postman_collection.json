{
	"info": {
		"_postman_id": "2f589649-d491-4be2-a7f2-ed9918b5622e",
		"name": "7. API SUNAT - Comunicación de Baja",
		"description": "Ejemplos completos de comunicación de baja (RA) para documentos electrónicos SUNAT\n\n## Flujo de Uso:\n1. **Obtener documentos disponibles** - Consultar qué documentos se pueden anular\n2. **Crear comunicación de baja** - Crear el documento RA con los detalles de anulación\n3. **Enviar a SUNAT** - Enviar la comunicación y obtener ticket\n4. **Consultar estado** - Verificar si fue aceptada o rechazada\n5. **Descargar archivos** - Obtener XML y CDR de respuesta\n\n## Casos de Uso Incluidos:\n- Anulación de factura por error de cálculo\n- Anulación múltiple de boletas por datos incorrectos\n- Anulación mixta de diferentes tipos de documentos\n- Manejo de diferentes estados de SUNAT\n- Filtros avanzados de consulta",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json",
		"_exporter_id": "20633485"
	},
	"item": [
		{
			"name": "1. Obtener Documentos Disponibles para Anular",
			"request": {
				"method": "GET",
				"header": [
					{
						"key": "Accept",
						"value": "application/json",
						"type": "text"
					},
					{
						"key": "Content-Type",
						"value": "application/json",
						"type": "text"
					}
				],
				"url": {
					"raw": "http://localhost:8000/api/v1/voided-documents/available-documents?company_id=1&branch_id=1&fecha_referencia=2025-09-06",
					"protocol": "http",
					"host": [
						"localhost"
					],
					"port": "8000",
					"path": [
						"api",
						"v1",
						"voided-documents",
						"available-documents"
					],
					"query": [
						{
							"key": "company_id",
							"value": "1",
							"description": "ID de la empresa"
						},
						{
							"key": "branch_id",
							"value": "1",
							"description": "ID de la sucursal"
						},
						{
							"key": "fecha_referencia",
							"value": "2025-09-06",
							"description": "Fecha de los documentos a consultar (YYYY-MM-DD)"
						},
						{
							"key": "tipo_documento",
							"value": "",
							"description": "Filtrar por tipo: 01, 03, 07, 08, 09 (opcional)",
							"disabled": true
						}
					]
				},
				"description": "Obtiene los documentos ACEPTADOS por SUNAT que pueden ser anulados mediante comunicación de baja. Solo se pueden anular documentos de los últimos 7 días calendario."
			},
			"response": [
				{
					"name": "Respuesta exitosa",
					"originalRequest": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{BASE_URL}}/api/v1/voided-documents/available-documents?company_id=1&branch_id=1&fecha_referencia=2025-09-06",
							"host": [
								"{{BASE_URL}}"
							],
							"path": [
								"api",
								"v1",
								"voided-documents",
								"available-documents"
							],
							"query": [
								{
									"key": "company_id",
									"value": "1"
								},
								{
									"key": "branch_id",
									"value": "1"
								},
								{
									"key": "fecha_referencia",
									"value": "2025-09-06"
								}
							]
						}
					},
					"status": "OK",
					"code": 200,
					"_postman_previewlanguage": "json",
					"header": [
						{
							"key": "Content-Type",
							"value": "application/json"
						}
					],
					"cookie": [],
					"body": "{\n  \"success\": true,\n  \"data\": [\n    {\n      \"id\": 123,\n      \"tipo_documento\": \"01\",\n      \"serie\": \"F001\",\n      \"correlativo\": \"00000456\",\n      \"numero_completo\": \"F001-00000456\",\n      \"monto\": \"1180.00\",\n      \"tipo_nombre\": \"Factura\",\n      \"fecha_emision\": \"2025-09-06\",\n      \"cliente\": \"CLIENTE DE PRUEBA S.A.C.\",\n      \"estado_sunat\": \"ACEPTADO\"\n    },\n    {\n      \"id\": 789,\n      \"tipo_documento\": \"03\",\n      \"serie\": \"B001\",\n      \"correlativo\": \"00001234\",\n      \"numero_completo\": \"B001-00001234\",\n      \"monto\": \"354.00\",\n      \"tipo_nombre\": \"Boleta\",\n      \"fecha_emision\": \"2025-09-06\",\n      \"cliente\": \"CONSUMIDOR FINAL\",\n      \"estado_sunat\": \"ACEPTADO\"\n    }\n  ],\n  \"total\": 2,\n  \"message\": \"Documentos disponibles para anulación obtenidos correctamente\"\n}"
				}
			]
		},
		{
			"name": "2. Crear Comunicación de Baja - Factura con Error",
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Content-Type",
						"value": "application/json"
					},
					{
						"key": "Accept",
						"value": "application/json"
					},
					{
						"key": "Authorization",
						"value": "Bearer 2|sunat_beta_nssgIjrjpbRlcCr7COMwik0xLf5MdZUjs3jVmhl875670cb4",
						"type": "text"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n  \"company_id\": 2,\n  \"branch_id\": 2,\n  \"fecha_referencia\": \"2025-09-06\",\n  \"motivo_baja\": \"ERROR EN CÁLCULO DE IGV - DOCUMENTO NO ENTREGADO AL CLIENTE\",\n  \"detalles\": [\n    {\n      \"tipo_documento\": \"01\",\n      \"serie\": \"F001\",\n      \"correlativo\": \"00000123\",\n      \"motivo_especifico\": \"Error en aplicación de IGV por tipo de afectación incorrecta\"\n    }\n  ],\n  \"usuario_creacion\": \"admin\",\n  \"ubl_version\": \"2.0\"\n}"
				},
				"url": {
					"raw": "http://localhost:8000/api/v1/voided-documents",
					"protocol": "http",
					"host": [
						"localhost"
					],
					"port": "8000",
					"path": [
						"api",
						"v1",
						"voided-documents"
					]
				},
				"description": "**Escenario**: Anular factura por error en cálculos de IGV\n\n**Caso de uso**: Una factura fue emitida con un error en el cálculo del IGV debido a una afectación incorrecta aplicada por error del sistema. El documento no fue entregado al cliente, por lo que se procede con la anulación."
			},
			"response": [
				{
					"name": "Comunicación creada exitosamente",
					"originalRequest": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"company_id\": 1,\n  \"branch_id\": 1,\n  \"fecha_referencia\": \"2025-09-06\",\n  \"motivo_baja\": \"ERROR EN CÁLCULO DE IGV - DOCUMENTO NO ENTREGADO AL CLIENTE\",\n  \"detalles\": [\n    {\n      \"tipo_documento\": \"01\",\n      \"serie\": \"F001\",\n      \"correlativo\": \"00000123\",\n      \"motivo_especifico\": \"Error en aplicación de IGV por tipo de afectación incorrecta\"\n    }\n  ],\n  \"usuario_creacion\": \"admin\"\n}"
						},
						"url": {
							"raw": "{{BASE_URL}}/api/v1/voided-documents",
							"host": [
								"{{BASE_URL}}"
							],
							"path": [
								"api",
								"v1",
								"voided-documents"
							]
						}
					},
					"status": "Created",
					"code": 201,
					"_postman_previewlanguage": "json",
					"header": [
						{
							"key": "Content-Type",
							"value": "application/json"
						}
					],
					"cookie": [],
					"body": "{\n  \"success\": true,\n  \"data\": {\n    \"id\": 5,\n    \"company_id\": 1,\n    \"branch_id\": 1,\n    \"tipo_documento\": \"RA\",\n    \"identificador\": \"20123456789-RA-20250906-001\",\n    \"correlativo\": \"001\",\n    \"fecha_emision\": \"2025-09-06T00:00:00.000000Z\",\n    \"fecha_referencia\": \"2025-09-06T00:00:00.000000Z\",\n    \"ubl_version\": \"2.0\",\n    \"detalles\": [\n      {\n        \"tipo_documento\": \"01\",\n        \"serie\": \"F001\",\n        \"correlativo\": \"00000123\",\n        \"motivo_especifico\": \"Error en aplicación de IGV por tipo de afectación incorrecta\"\n      }\n    ],\n    \"motivo_baja\": \"ERROR EN CÁLCULO DE IGV - DOCUMENTO NO ENTREGADO AL CLIENTE\",\n    \"total_documentos\": 1,\n    \"estado_sunat\": \"PENDIENTE\",\n    \"usuario_creacion\": \"admin\",\n    \"created_at\": \"2025-09-06T10:30:00.000000Z\",\n    \"updated_at\": \"2025-09-06T10:30:00.000000Z\",\n    \"company\": {\n      \"id\": 1,\n      \"ruc\": \"20123456789\",\n      \"razon_social\": \"EMPRESA DE PRUEBAS GREENTER S.A.C.\"\n    },\n    \"branch\": {\n      \"id\": 1,\n      \"codigo\": \"0001\",\n      \"nombre\": \"SUCURSAL PRINCIPAL\"\n    }\n  },\n  \"message\": \"Comunicación de baja creada correctamente\"\n}"
				}
			]
		},
		{
			"name": "3. Crear Comunicación de Baja - Múltiples Boletas",
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Content-Type",
						"value": "application/json"
					},
					{
						"key": "Accept",
						"value": "application/json"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n  \"company_id\": 1,\n  \"branch_id\": 1,\n  \"fecha_referencia\": \"2025-09-05\",\n  \"motivo_baja\": \"DATOS INCORRECTOS DEL CLIENTE - DOCUMENTOS NO ENTREGADOS\",\n  \"detalles\": [\n    {\n      \"tipo_documento\": \"03\",\n      \"serie\": \"B001\",\n      \"correlativo\": \"00005678\",\n      \"motivo_especifico\": \"Cliente incorrecto - DNI errado en sistema\"\n    },\n    {\n      \"tipo_documento\": \"03\",\n      \"serie\": \"B001\",\n      \"correlativo\": \"00005679\",\n      \"motivo_especifico\": \"Cliente incorrecto - Nombre mal registrado\"\n    },\n    {\n      \"tipo_documento\": \"03\",\n      \"serie\": \"B002\",\n      \"correlativo\": \"00001234\",\n      \"motivo_especifico\": \"Dirección del cliente incorrecta - no coincide con base de datos\"\n    }\n  ],\n  \"usuario_creacion\": \"vendedor01\",\n  \"ubl_version\": \"2.1\"\n}"
				},
				"url": {
					"raw": "http://localhost:8000/api/v1/voided-documents",
					"protocol": "http",
					"host": [
						"localhost"
					],
					"port": "8000",
					"path": [
						"api",
						"v1",
						"voided-documents"
					]
				},
				"description": "**Escenario**: Anular múltiples boletas por datos de cliente incorrectos\n\n**Caso de uso**: Se detectó que varias boletas fueron emitidas con datos incorrectos del cliente debido a un error en el sistema de facturación. Los documentos no fueron entregados a los clientes, por lo que se procede con la anulación masiva."
			},
			"response": [
				{
					"name": "Múltiples boletas creadas",
					"originalRequest": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"company_id\": 1,\n  \"branch_id\": 1,\n  \"fecha_referencia\": \"2025-09-05\",\n  \"motivo_baja\": \"DATOS INCORRECTOS DEL CLIENTE - DOCUMENTOS NO ENTREGADOS\",\n  \"detalles\": [\n    {\n      \"tipo_documento\": \"03\",\n      \"serie\": \"B001\",\n      \"correlativo\": \"00005678\",\n      \"motivo_especifico\": \"Cliente incorrecto - DNI errado en sistema\"\n    },\n    {\n      \"tipo_documento\": \"03\",\n      \"serie\": \"B001\",\n      \"correlativo\": \"00005679\",\n      \"motivo_especifico\": \"Cliente incorrecto - Nombre mal registrado\"\n    },\n    {\n      \"tipo_documento\": \"03\",\n      \"serie\": \"B002\",\n      \"correlativo\": \"00001234\",\n      \"motivo_especifico\": \"Dirección del cliente incorrecta - no coincide con base de datos\"\n    }\n  ],\n  \"usuario_creacion\": \"vendedor01\"\n}"
						},
						"url": {
							"raw": "{{BASE_URL}}/api/v1/voided-documents",
							"host": [
								"{{BASE_URL}}"
							],
							"path": [
								"api",
								"v1",
								"voided-documents"
							]
						}
					},
					"status": "Created",
					"code": 201,
					"_postman_previewlanguage": "json",
					"header": [
						{
							"key": "Content-Type",
							"value": "application/json"
						}
					],
					"cookie": [],
					"body": "{\n  \"success\": true,\n  \"data\": {\n    \"id\": 6,\n    \"company_id\": 1,\n    \"branch_id\": 1,\n    \"tipo_documento\": \"RA\",\n    \"identificador\": \"20123456789-RA-20250905-002\",\n    \"correlativo\": \"002\",\n    \"fecha_emision\": \"2025-09-06T00:00:00.000000Z\",\n    \"fecha_referencia\": \"2025-09-05T00:00:00.000000Z\",\n    \"ubl_version\": \"2.1\",\n    \"detalles\": [\n      {\n        \"tipo_documento\": \"03\",\n        \"serie\": \"B001\",\n        \"correlativo\": \"00005678\",\n        \"motivo_especifico\": \"Cliente incorrecto - DNI errado en sistema\"\n      },\n      {\n        \"tipo_documento\": \"03\",\n        \"serie\": \"B001\",\n        \"correlativo\": \"00005679\",\n        \"motivo_especifico\": \"Cliente incorrecto - Nombre mal registrado\"\n      },\n      {\n        \"tipo_documento\": \"03\",\n        \"serie\": \"B002\",\n        \"correlativo\": \"00001234\",\n        \"motivo_especifico\": \"Dirección del cliente incorrecta - no coincide con base de datos\"\n      }\n    ],\n    \"motivo_baja\": \"DATOS INCORRECTOS DEL CLIENTE - DOCUMENTOS NO ENTREGADOS\",\n    \"total_documentos\": 3,\n    \"estado_sunat\": \"PENDIENTE\",\n    \"usuario_creacion\": \"vendedor01\",\n    \"created_at\": \"2025-09-06T10:45:00.000000Z\",\n    \"updated_at\": \"2025-09-06T10:45:00.000000Z\"\n  },\n  \"message\": \"Comunicación de baja creada correctamente\"\n}"
				}
			]
		},
		{
			"name": "4. Crear Comunicación de Baja - Documentos Mixtos",
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Content-Type",
						"value": "application/json"
					},
					{
						"key": "Accept",
						"value": "application/json"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n  \"company_id\": 1,\n  \"branch_id\": 1,\n  \"fecha_referencia\": \"2025-09-04\",\n  \"motivo_baja\": \"DOCUMENTOS EMITIDOS POR ERROR OPERATIVO\",\n  \"detalles\": [\n    {\n      \"tipo_documento\": \"01\",\n      \"serie\": \"F001\",\n      \"correlativo\": \"00000456\",\n      \"motivo_especifico\": \"Factura duplicada por error de sistema - ya existe F001-00000455\"\n    },\n    {\n      \"tipo_documento\": \"03\",\n      \"serie\": \"B001\",\n      \"correlativo\": \"00006789\",\n      \"motivo_especifico\": \"Boleta emitida por error - cliente canceló la compra antes de la emisión\"\n    },\n    {\n      \"tipo_documento\": \"07\",\n      \"serie\": \"FC01\",\n      \"correlativo\": \"00000089\",\n      \"motivo_especifico\": \"Nota de crédito emitida sin sustento válido - no aplica devolución\"\n    }\n  ],\n  \"usuario_creacion\": \"supervisor\",\n  \"ubl_version\": \"2.0\"\n}"
				},
				"url": {
					"raw": "http://localhost:8000/api/v1/voided-documents",
					"protocol": "http",
					"host": [
						"localhost"
					],
					"port": "8000",
					"path": [
						"api",
						"v1",
						"voided-documents"
					]
				},
				"description": "**Escenario**: Anular diferentes tipos de documentos del mismo día\n\n**Caso de uso**: Se detectaron varios documentos emitidos por error operativo: una factura duplicada, una boleta emitida para un cliente que canceló la compra, y una nota de crédito sin sustento válido."
			},
			"response": [
				{
					"name": "Documentos mixtos creados",
					"originalRequest": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"company_id\": 1,\n  \"branch_id\": 1,\n  \"fecha_referencia\": \"2025-09-04\",\n  \"motivo_baja\": \"DOCUMENTOS EMITIDOS POR ERROR OPERATIVO\",\n  \"detalles\": [\n    {\n      \"tipo_documento\": \"01\",\n      \"serie\": \"F001\",\n      \"correlativo\": \"00000456\",\n      \"motivo_especifico\": \"Factura duplicada por error de sistema\"\n    },\n    {\n      \"tipo_documento\": \"03\",\n      \"serie\": \"B001\",\n      \"correlativo\": \"00006789\",\n      \"motivo_especifico\": \"Boleta emitida por error - cliente canceló la compra\"\n    },\n    {\n      \"tipo_documento\": \"07\",\n      \"serie\": \"FC01\",\n      \"correlativo\": \"00000089\",\n      \"motivo_especifico\": \"Nota de crédito emitida sin sustento válido\"\n    }\n  ],\n  \"usuario_creacion\": \"supervisor\"\n}"
						},
						"url": {
							"raw": "{{BASE_URL}}/api/v1/voided-documents",
							"host": [
								"{{BASE_URL}}"
							],
							"path": [
								"api",
								"v1",
								"voided-documents"
							]
						}
					},
					"status": "Created",
					"code": 201,
					"_postman_previewlanguage": "json",
					"header": [
						{
							"key": "Content-Type",
							"value": "application/json"
						}
					],
					"cookie": [],
					"body": "{\n  \"success\": true,\n  \"data\": {\n    \"id\": 7,\n    \"company_id\": 1,\n    \"branch_id\": 1,\n    \"tipo_documento\": \"RA\",\n    \"identificador\": \"20123456789-RA-20250904-001\",\n    \"correlativo\": \"001\",\n    \"fecha_emision\": \"2025-09-06T00:00:00.000000Z\",\n    \"fecha_referencia\": \"2025-09-04T00:00:00.000000Z\",\n    \"ubl_version\": \"2.0\",\n    \"detalles\": [\n      {\n        \"tipo_documento\": \"01\",\n        \"serie\": \"F001\",\n        \"correlativo\": \"00000456\",\n        \"motivo_especifico\": \"Factura duplicada por error de sistema - ya existe F001-00000455\"\n      },\n      {\n        \"tipo_documento\": \"03\",\n        \"serie\": \"B001\",\n        \"correlativo\": \"00006789\",\n        \"motivo_especifico\": \"Boleta emitida por error - cliente canceló la compra antes de la emisión\"\n      },\n      {\n        \"tipo_documento\": \"07\",\n        \"serie\": \"FC01\",\n        \"correlativo\": \"00000089\",\n        \"motivo_especifico\": \"Nota de crédito emitida sin sustento válido - no aplica devolución\"\n      }\n    ],\n    \"motivo_baja\": \"DOCUMENTOS EMITIDOS POR ERROR OPERATIVO\",\n    \"total_documentos\": 3,\n    \"estado_sunat\": \"PENDIENTE\",\n    \"usuario_creacion\": \"supervisor\",\n    \"created_at\": \"2025-09-06T11:00:00.000000Z\",\n    \"updated_at\": \"2025-09-06T11:00:00.000000Z\"\n  },\n  \"message\": \"Comunicación de baja creada correctamente\"\n}"
				}
			]
		},
		{
			"name": "5. Enviar Comunicación de Baja a SUNAT",
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Accept",
						"value": "application/json"
					},
					{
						"key": "Content-Type",
						"value": "application/json",
						"type": "text"
					},
					{
						"key": "Authorization",
						"value": "Bearer 2|sunat_beta_nssgIjrjpbRlcCr7COMwik0xLf5MdZUjs3jVmhl875670cb4",
						"type": "text"
					}
				],
				"body": {
					"mode": "raw",
					"raw": ""
				},
				"url": {
					"raw": "http://localhost:8000/api/v1/voided-documents/1/send-sunat",
					"protocol": "http",
					"host": [
						"localhost"
					],
					"port": "8000",
					"path": [
						"api",
						"v1",
						"voided-documents",
						"1",
						"send-sunat"
					]
				},
				"description": "Envía la comunicación de baja a SUNAT y recibe un ticket para consulta posterior del estado de procesamiento. Este proceso es asíncrono."
			},
			"response": [
				{
					"name": "Enviado exitosamente",
					"originalRequest": {
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": ""
						},
						"url": {
							"raw": "{{BASE_URL}}/api/v1/voided-documents/5/send-sunat",
							"host": [
								"{{BASE_URL}}"
							],
							"path": [
								"api",
								"v1",
								"voided-documents",
								"5",
								"send-sunat"
							]
						}
					},
					"status": "OK",
					"code": 200,
					"_postman_previewlanguage": "json",
					"header": [
						{
							"key": "Content-Type",
							"value": "application/json"
						}
					],
					"cookie": [],
					"body": "{\n  \"success\": true,\n  \"data\": {\n    \"id\": 5,\n    \"estado_sunat\": \"ENVIADO\",\n    \"ticket\": \"1542330021158\",\n    \"xml_path\": \"public/voided_documents/xml/20250906/20123456789-RA-20250906-001.xml\",\n    \"codigo_hash\": \"abc123def456789\",\n    \"fecha_envio_sunat\": \"2025-09-06T10:35:00.000000Z\"\n  },\n  \"ticket\": \"1542330021158\",\n  \"message\": \"Comunicación de baja enviada correctamente a SUNAT\"\n}"
				}
			]
		},
		{
			"name": "6. Consultar Estado de Comunicación de Baja",
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Accept",
						"value": "application/json"
					},
					{
						"key": "Content-Type",
						"value": "application/json",
						"type": "text"
					},
					{
						"key": "Authorization",
						"value": "Bearer 2|sunat_beta_nssgIjrjpbRlcCr7COMwik0xLf5MdZUjs3jVmhl875670cb4",
						"type": "text"
					}
				],
				"body": {
					"mode": "raw",
					"raw": ""
				},
				"url": {
					"raw": "http://localhost:8000/api/v1/voided-documents/1/check-status",
					"protocol": "http",
					"host": [
						"localhost"
					],
					"port": "8000",
					"path": [
						"api",
						"v1",
						"voided-documents",
						"1",
						"check-status"
					]
				},
				"description": "Consulta el estado de procesamiento de la comunicación de baja en SUNAT usando el ticket obtenido en el envío. Estados posibles: PROCESANDO, ACEPTADO, RECHAZADO."
			},
			"response": [
				{
					"name": "Estado ACEPTADO",
					"originalRequest": {
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": ""
						},
						"url": {
							"raw": "{{BASE_URL}}/api/v1/voided-documents/5/check-status",
							"host": [
								"{{BASE_URL}}"
							],
							"path": [
								"api",
								"v1",
								"voided-documents",
								"5",
								"check-status"
							]
						}
					},
					"status": "OK",
					"code": 200,
					"_postman_previewlanguage": "json",
					"header": [
						{
							"key": "Content-Type",
							"value": "application/json"
						}
					],
					"cookie": [],
					"body": "{\n  \"success\": true,\n  \"data\": {\n    \"id\": 5,\n    \"estado_sunat\": \"ACEPTADO\",\n    \"respuesta_sunat\": \"{\\\"code\\\":\\\"0\\\",\\\"description\\\":\\\"La Comunicacion de baja ha sido aceptada\\\"}\",\n    \"cdr_path\": \"public/voided_documents/cdr/20250906/R-20123456789-RA-20250906-001.zip\",\n    \"fecha_procesamiento_sunat\": \"2025-09-06T10:40:00.000000Z\"\n  },\n  \"message\": \"Estado consultado correctamente\"\n}"
				},
				{
					"name": "Estado PROCESANDO",
					"originalRequest": {
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": ""
						},
						"url": {
							"raw": "{{BASE_URL}}/api/v1/voided-documents/6/check-status",
							"host": [
								"{{BASE_URL}}"
							],
							"path": [
								"api",
								"v1",
								"voided-documents",
								"6",
								"check-status"
							]
						}
					},
					"status": "OK",
					"code": 200,
					"_postman_previewlanguage": "json",
					"header": [
						{
							"key": "Content-Type",
							"value": "application/json"
						}
					],
					"cookie": [],
					"body": "{\n  \"success\": true,\n  \"data\": {\n    \"id\": 6,\n    \"estado_sunat\": \"PROCESANDO\",\n    \"respuesta_sunat\": null,\n    \"ticket\": \"1542330021159\"\n  },\n  \"message\": \"Estado consultado correctamente - aún procesando\"\n}"
				},
				{
					"name": "Estado RECHAZADO",
					"originalRequest": {
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": ""
						},
						"url": {
							"raw": "{{BASE_URL}}/api/v1/voided-documents/7/check-status",
							"host": [
								"{{BASE_URL}}"
							],
							"path": [
								"api",
								"v1",
								"voided-documents",
								"7",
								"check-status"
							]
						}
					},
					"status": "OK",
					"code": 200,
					"_postman_previewlanguage": "json",
					"header": [
						{
							"key": "Content-Type",
							"value": "application/json"
						}
					],
					"cookie": [],
					"body": "{\n  \"success\": true,\n  \"data\": {\n    \"id\": 7,\n    \"estado_sunat\": \"RECHAZADO\",\n    \"respuesta_sunat\": \"{\\\"code\\\":\\\"2335\\\",\\\"description\\\":\\\"Documento ya fue informado anteriormente\\\"}\",\n    \"cdr_path\": null,\n    \"fecha_procesamiento_sunat\": \"2025-09-06T11:05:00.000000Z\"\n  },\n  \"message\": \"Estado consultado correctamente\"\n}"
				}
			]
		},
		{
			"name": "7. Listar Comunicaciones de Baja",
			"request": {
				"method": "GET",
				"header": [
					{
						"key": "Accept",
						"value": "application/json"
					}
				],
				"url": {
					"raw": "http://localhost:8000/api/v1/voided-documents?company_id=1&estado_sunat=ACEPTADO&per_page=10",
					"protocol": "http",
					"host": [
						"localhost"
					],
					"port": "8000",
					"path": [
						"api",
						"v1",
						"voided-documents"
					],
					"query": [
						{
							"key": "branch_id",
							"value": "",
							"description": "Filtrar por sucursal (opcional)",
							"disabled": true
						},
						{
							"key": "fecha_desde",
							"value": "",
							"description": "Fecha desde (YYYY-MM-DD) (opcional)",
							"disabled": true
						},
						{
							"key": "fecha_hasta",
							"value": "",
							"description": "Fecha hasta (YYYY-MM-DD) (opcional)",
							"disabled": true
						},
						{
							"key": "fecha_referencia",
							"value": "",
							"description": "Fecha de documentos anulados (opcional)",
							"disabled": true
						},
						{
							"key": "company_id",
							"value": "1"
						},
						{
							"key": "estado_sunat",
							"value": "ACEPTADO"
						},
						{
							"key": "per_page",
							"value": "10"
						}
					]
				},
				"description": "Lista las comunicaciones de baja con filtros opcionales y paginación. Permite filtrar por empresa, sucursal, estado SUNAT, rangos de fecha, etc."
			},
			"response": [
				{
					"name": "Lista paginada",
					"originalRequest": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{BASE_URL}}/api/v1/voided-documents?company_id=1&estado_sunat=ACEPTADO&per_page=10",
							"host": [
								"{{BASE_URL}}"
							],
							"path": [
								"api",
								"v1",
								"voided-documents"
							],
							"query": [
								{
									"key": "company_id",
									"value": "1"
								},
								{
									"key": "estado_sunat",
									"value": "ACEPTADO"
								},
								{
									"key": "per_page",
									"value": "10"
								}
							]
						}
					},
					"status": "OK",
					"code": 200,
					"_postman_previewlanguage": "json",
					"header": [
						{
							"key": "Content-Type",
							"value": "application/json"
						}
					],
					"cookie": [],
					"body": "{\n  \"success\": true,\n  \"data\": {\n    \"current_page\": 1,\n    \"data\": [\n      {\n        \"id\": 5,\n        \"identificador\": \"20123456789-RA-20250906-001\",\n        \"correlativo\": \"001\",\n        \"fecha_emision\": \"2025-09-06\",\n        \"fecha_referencia\": \"2025-09-06\",\n        \"total_documentos\": 1,\n        \"estado_sunat\": \"ACEPTADO\",\n        \"motivo_baja\": \"ERROR EN CÁLCULO DE IGV - DOCUMENTO NO ENTREGADO AL CLIENTE\",\n        \"usuario_creacion\": \"admin\",\n        \"created_at\": \"2025-09-06T10:30:00.000000Z\",\n        \"company\": {\n          \"ruc\": \"20123456789\",\n          \"razon_social\": \"EMPRESA DE PRUEBAS GREENTER S.A.C.\"\n        },\n        \"branch\": {\n          \"codigo\": \"0001\",\n          \"nombre\": \"SUCURSAL PRINCIPAL\"\n        }\n      }\n    ],\n    \"first_page_url\": \"{{BASE_URL}}/api/v1/voided-documents?page=1\",\n    \"from\": 1,\n    \"last_page\": 1,\n    \"last_page_url\": \"{{BASE_URL}}/api/v1/voided-documents?page=1\",\n    \"links\": [\n      {\n        \"url\": null,\n        \"label\": \"&laquo; Previous\",\n        \"active\": false\n      },\n      {\n        \"url\": \"{{BASE_URL}}/api/v1/voided-documents?page=1\",\n        \"label\": \"1\",\n        \"active\": true\n      },\n      {\n        \"url\": null,\n        \"label\": \"Next &raquo;\",\n        \"active\": false\n      }\n    ],\n    \"next_page_url\": null,\n    \"path\": \"{{BASE_URL}}/api/v1/voided-documents\",\n    \"per_page\": 10,\n    \"prev_page_url\": null,\n    \"to\": 1,\n    \"total\": 1\n  },\n  \"message\": \"Comunicaciones de baja obtenidas correctamente\"\n}"
				}
			]
		},
		{
			"name": "8. Ver Detalle de Comunicación de Baja",
			"request": {
				"method": "GET",
				"header": [
					{
						"key": "Accept",
						"value": "application/json"
					},
					{
						"key": "Content-Type",
						"value": "application/json",
						"type": "text"
					},
					{
						"key": "Authorization",
						"value": "Bearer 2|sunat_beta_nssgIjrjpbRlcCr7COMwik0xLf5MdZUjs3jVmhl875670cb4",
						"type": "text"
					}
				],
				"url": {
					"raw": "http://localhost:8000/api/v1/voided-documents/1",
					"protocol": "http",
					"host": [
						"localhost"
					],
					"port": "8000",
					"path": [
						"api",
						"v1",
						"voided-documents",
						"1"
					]
				},
				"description": "Obtiene el detalle completo de una comunicación de baja específica, incluyendo todos los documentos anulados, rutas de archivos, y relaciones con empresa y sucursal."
			},
			"response": [
				{
					"name": "Detalle completo",
					"originalRequest": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{BASE_URL}}/api/v1/voided-documents/5",
							"host": [
								"{{BASE_URL}}"
							],
							"path": [
								"api",
								"v1",
								"voided-documents",
								"5"
							]
						}
					},
					"status": "OK",
					"code": 200,
					"_postman_previewlanguage": "json",
					"header": [
						{
							"key": "Content-Type",
							"value": "application/json"
						}
					],
					"cookie": [],
					"body": "{\n  \"success\": true,\n  \"data\": {\n    \"id\": 5,\n    \"company_id\": 1,\n    \"branch_id\": 1,\n    \"tipo_documento\": \"RA\",\n    \"identificador\": \"20123456789-RA-20250906-001\",\n    \"correlativo\": \"001\",\n    \"fecha_emision\": \"2025-09-06T00:00:00.000000Z\",\n    \"fecha_referencia\": \"2025-09-06T00:00:00.000000Z\",\n    \"ubl_version\": \"2.0\",\n    \"detalles\": [\n      {\n        \"tipo_documento\": \"01\",\n        \"serie\": \"F001\",\n        \"correlativo\": \"00000123\",\n        \"motivo_especifico\": \"Error en aplicación de IGV por tipo de afectación incorrecta\"\n      }\n    ],\n    \"motivo_baja\": \"ERROR EN CÁLCULO DE IGV - DOCUMENTO NO ENTREGADO AL CLIENTE\",\n    \"total_documentos\": 1,\n    \"xml_path\": \"public/voided_documents/xml/20250906/20123456789-RA-20250906-001.xml\",\n    \"cdr_path\": \"public/voided_documents/cdr/20250906/R-20123456789-RA-20250906-001.zip\",\n    \"estado_sunat\": \"ACEPTADO\",\n    \"respuesta_sunat\": \"{\\\"code\\\":\\\"0\\\",\\\"description\\\":\\\"La Comunicacion de baja ha sido aceptada\\\"}\",\n    \"ticket\": \"1542330021158\",\n    \"codigo_hash\": \"abc123def456789\",\n    \"fecha_envio_sunat\": \"2025-09-06T10:35:00.000000Z\",\n    \"fecha_procesamiento_sunat\": \"2025-09-06T10:40:00.000000Z\",\n    \"usuario_creacion\": \"admin\",\n    \"created_at\": \"2025-09-06T10:30:00.000000Z\",\n    \"updated_at\": \"2025-09-06T10:40:00.000000Z\",\n    \"company\": {\n      \"id\": 1,\n      \"ruc\": \"20123456789\",\n      \"razon_social\": \"EMPRESA DE PRUEBAS GREENTER S.A.C.\",\n      \"nombre_comercial\": \"GREENTER\",\n      \"direccion\": \"AV. GRAU 123 - LIMA - LIMA - PERÚ\"\n    },\n    \"branch\": {\n      \"id\": 1,\n      \"codigo\": \"0001\",\n      \"nombre\": \"SUCURSAL PRINCIPAL\",\n      \"direccion\": \"AV. GRAU 123 - LIMA - LIMA - PERÚ\"\n    }\n  }\n}"
				}
			]
		},
		{
			"name": "9. Descargar XML de Comunicación de Baja",
			"request": {
				"method": "GET",
				"header": [],
				"url": {
					"raw": "{{BASE_URL}}/api/v1/voided-documents/5/download-xml",
					"host": [
						"{{BASE_URL}}"
					],
					"path": [
						"api",
						"v1",
						"voided-documents",
						"5",
						"download-xml"
					]
				},
				"description": "Descarga el archivo XML de la comunicación de baja enviado a SUNAT. Solo disponible después de que la comunicación haya sido enviada."
			},
			"response": [
				{
					"name": "Archivo XML",
					"originalRequest": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{BASE_URL}}/api/v1/voided-documents/5/download-xml",
							"host": [
								"{{BASE_URL}}"
							],
							"path": [
								"api",
								"v1",
								"voided-documents",
								"5",
								"download-xml"
							]
						}
					},
					"status": "OK",
					"code": 200,
					"_postman_previewlanguage": "xml",
					"header": [
						{
							"key": "Content-Type",
							"value": "application/xml"
						},
						{
							"key": "Content-Disposition",
							"value": "attachment; filename=20123456789-RA-20250906-001.xml"
						}
					],
					"cookie": [],
					"body": "<?xml version=\"1.0\" encoding=\"utf-8\"?>\n<VoidedDocuments xmlns=\"urn:sunat:names:specification:ubl:peru:schema:xsd:VoidedDocuments-1\"\n                 xmlns:cac=\"urn:oasis:names:specification:ubl:schema:xsd:CommonAggregateComponents-2\"\n                 xmlns:cbc=\"urn:oasis:names:specification:ubl:schema:xsd:CommonBasicComponents-2\"\n                 xmlns:ds=\"http://www.w3.org/2000/09/xmldsig#\"\n                 xmlns:ext=\"urn:oasis:names:specification:ubl:schema:xsd:CommonExtensionComponents-2\"\n                 xmlns:sac=\"urn:sunat:names:specification:ubl:peru:schema:xsd:SunatAggregateComponents-1\"\n                 xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\">\n  <ext:UBLExtensions>\n    <!-- Estructura UBL con firma digital -->\n  </ext:UBLExtensions>\n  <cbc:UBLVersionID>2.0</cbc:UBLVersionID>\n  <cbc:CustomizationID>1.0</cbc:CustomizationID>\n  <cbc:ID>RA-20250906-001</cbc:ID>\n  <cbc:ReferenceDate>2025-09-06</cbc:ReferenceDate>\n  <cbc:IssueDate>2025-09-06</cbc:IssueDate>\n  <!-- Resto del XML estructurado según UBL -->\n</VoidedDocuments>"
				}
			]
		},
		{
			"name": "10. Descargar CDR de Comunicación de Baja",
			"request": {
				"method": "GET",
				"header": [],
				"url": {
					"raw": "{{BASE_URL}}/api/v1/voided-documents/5/download-cdr",
					"host": [
						"{{BASE_URL}}"
					],
					"path": [
						"api",
						"v1",
						"voided-documents",
						"5",
						"download-cdr"
					]
				},
				"description": "Descarga el archivo CDR (Comprobante de Recepción) de SUNAT para una comunicación de baja aceptada. Solo disponible cuando el estado es ACEPTADO."
			},
			"response": [
				{
					"name": "Archivo CDR",
					"originalRequest": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{BASE_URL}}/api/v1/voided-documents/5/download-cdr",
							"host": [
								"{{BASE_URL}}"
							],
							"path": [
								"api",
								"v1",
								"voided-documents",
								"5",
								"download-cdr"
							]
						}
					},
					"status": "OK",
					"code": 200,
					"_postman_previewlanguage": "zip",
					"header": [
						{
							"key": "Content-Type",
							"value": "application/zip"
						},
						{
							"key": "Content-Disposition",
							"value": "attachment; filename=R-20123456789-RA-20250906-001.zip"
						}
					],
					"cookie": [],
					"body": "[BINARY CDR ZIP FILE]"
				},
				{
					"name": "CDR no disponible",
					"originalRequest": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{BASE_URL}}/api/v1/voided-documents/7/download-cdr",
							"host": [
								"{{BASE_URL}}"
							],
							"path": [
								"api",
								"v1",
								"voided-documents",
								"7",
								"download-cdr"
							]
						}
					},
					"status": "Not Found",
					"code": 404,
					"_postman_previewlanguage": "json",
					"header": [
						{
							"key": "Content-Type",
							"value": "application/json"
						}
					],
					"cookie": [],
					"body": "{\n  \"success\": false,\n  \"message\": \"Archivo CDR no disponible - la comunicación no ha sido aceptada por SUNAT\"\n}"
				}
			]
		},
		{
			"name": "ERROR: Validación - Fecha fuera de rango",
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Content-Type",
						"value": "application/json"
					},
					{
						"key": "Accept",
						"value": "application/json"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n  \"company_id\": 1,\n  \"branch_id\": 1,\n  \"fecha_referencia\": \"2025-08-28\",\n  \"motivo_baja\": \"ERROR EN DATOS\",\n  \"detalles\": [\n    {\n      \"tipo_documento\": \"01\",\n      \"serie\": \"F001\",\n      \"correlativo\": \"00000999\",\n      \"motivo_especifico\": \"Error en datos\"\n    }\n  ]\n}"
				},
				"url": {
					"raw": "{{BASE_URL}}/api/v1/voided-documents",
					"host": [
						"{{BASE_URL}}"
					],
					"path": [
						"api",
						"v1",
						"voided-documents"
					]
				},
				"description": "**Ejemplo de error**: Intento de anular documentos con fecha fuera del rango permitido (más de 7 días)"
			},
			"response": [
				{
					"name": "Error de validación",
					"originalRequest": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"company_id\": 1,\n  \"branch_id\": 1,\n  \"fecha_referencia\": \"2025-08-28\",\n  \"motivo_baja\": \"ERROR EN DATOS\",\n  \"detalles\": [\n    {\n      \"tipo_documento\": \"01\",\n      \"serie\": \"F001\",\n      \"correlativo\": \"00000999\",\n      \"motivo_especifico\": \"Error en datos\"\n    }\n  ]\n}"
						},
						"url": {
							"raw": "{{BASE_URL}}/api/v1/voided-documents",
							"host": [
								"{{BASE_URL}}"
							],
							"path": [
								"api",
								"v1",
								"voided-documents"
							]
						}
					},
					"status": "Unprocessable Entity",
					"code": 422,
					"_postman_previewlanguage": "json",
					"header": [
						{
							"key": "Content-Type",
							"value": "application/json"
						}
					],
					"cookie": [],
					"body": "{\n  \"success\": false,\n  \"message\": \"Los datos enviados no son válidos\",\n  \"errors\": {\n    \"fecha_referencia\": [\n      \"Solo se pueden anular documentos emitidos en los últimos 7 días calendario.\"\n    ]\n  }\n}"
				}
			]
		},
		{
			"name": "ERROR: Documentos duplicados",
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Content-Type",
						"value": "application/json"
					},
					{
						"key": "Accept",
						"value": "application/json"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n  \"company_id\": 1,\n  \"branch_id\": 1,\n  \"fecha_referencia\": \"2025-09-06\",\n  \"motivo_baja\": \"ERROR EN DATOS\",\n  \"detalles\": [\n    {\n      \"tipo_documento\": \"01\",\n      \"serie\": \"F001\",\n      \"correlativo\": \"00000123\",\n      \"motivo_especifico\": \"Error 1\"\n    },\n    {\n      \"tipo_documento\": \"01\",\n      \"serie\": \"F001\",\n      \"correlativo\": \"00000123\",\n      \"motivo_especifico\": \"Error 2\"\n    }\n  ]\n}"
				},
				"url": {
					"raw": "{{BASE_URL}}/api/v1/voided-documents",
					"host": [
						"{{BASE_URL}}"
					],
					"path": [
						"api",
						"v1",
						"voided-documents"
					]
				},
				"description": "**Ejemplo de error**: Intento de incluir el mismo documento dos veces en la misma comunicación"
			},
			"response": [
				{
					"name": "Error documentos duplicados",
					"originalRequest": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"company_id\": 1,\n  \"branch_id\": 1,\n  \"fecha_referencia\": \"2025-09-06\",\n  \"motivo_baja\": \"ERROR EN DATOS\",\n  \"detalles\": [\n    {\n      \"tipo_documento\": \"01\",\n      \"serie\": \"F001\",\n      \"correlativo\": \"00000123\",\n      \"motivo_especifico\": \"Error 1\"\n    },\n    {\n      \"tipo_documento\": \"01\",\n      \"serie\": \"F001\",\n      \"correlativo\": \"00000123\",\n      \"motivo_especifico\": \"Error 2\"\n    }\n  ]\n}"
						},
						"url": {
							"raw": "{{BASE_URL}}/api/v1/voided-documents",
							"host": [
								"{{BASE_URL}}"
							],
							"path": [
								"api",
								"v1",
								"voided-documents"
							]
						}
					},
					"status": "Unprocessable Entity",
					"code": 422,
					"_postman_previewlanguage": "json",
					"header": [
						{
							"key": "Content-Type",
							"value": "application/json"
						}
					],
					"cookie": [],
					"body": "{\n  \"success\": false,\n  \"message\": \"Los datos enviados no son válidos\",\n  \"errors\": {\n    \"detalles.1\": [\n      \"Documento duplicado en la lista.\"\n    ]\n  }\n}"
				}
			]
		}
	],
	"event": [
		{
			"listen": "prerequest",
			"script": {
				"type": "text/javascript",
				"exec": [
					"// Script global que se ejecuta antes de cada request",
					"// Puedes agregar aquí lógica para autenticación, variables dinámicas, etc.",
					"",
					"// Ejemplo: Configurar fecha actual para pruebas",
					"const today = new Date();",
					"const yesterday = new Date(today);",
					"yesterday.setDate(yesterday.getDate() - 1);",
					"",
					"pm.globals.set('TODAY', today.toISOString().split('T')[0]);",
					"pm.globals.set('YESTERDAY', yesterday.toISOString().split('T')[0]);"
				]
			}
		},
		{
			"listen": "test",
			"script": {
				"type": "text/javascript",
				"exec": [
					"// Script global que se ejecuta después de cada response",
					"// Puedes agregar aquí validaciones comunes, logging, etc.",
					"",
					"// Validar que las respuestas exitosas tengan la estructura esperada",
					"if (pm.response.code >= 200 && pm.response.code < 300) {",
					"    pm.test('Response has success property', function () {",
					"        const jsonData = pm.response.json();",
					"        pm.expect(jsonData).to.have.property('success');",
					"    });",
					"    ",
					"    pm.test('Response has message property', function () {",
					"        const jsonData = pm.response.json();",
					"        pm.expect(jsonData).to.have.property('message');",
					"    });",
					"}",
					"",
					"// Log de respuestas para debugging",
					"console.log('Response Status:', pm.response.status);",
					"console.log('Response Time:', pm.response.responseTime + 'ms');"
				]
			}
		}
	],
	"variable": [
		{
			"key": "BASE_URL",
			"value": "http://localhost:8000",
			"type": "string",
			"description": "URL base de la API SUNAT. Cambiar según el entorno (local/staging/production)"
		},
		{
			"key": "COMPANY_ID",
			"value": "1",
			"type": "string",
			"description": "ID de empresa por defecto para las pruebas"
		},
		{
			"key": "BRANCH_ID",
			"value": "1",
			"type": "string",
			"description": "ID de sucursal por defecto para las pruebas"
		}
	]
}